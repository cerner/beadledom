

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>beadledom-jooq &mdash; Beadledom 2.7.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/github_fork.css" type="text/css" />
  

  
    <link rel="top" title="Beadledom 2.7.2 documentation" href="../index.html"/>
        <link rel="up" title="User Manual" href="index.html"/>
        <link rel="next" title="beadledom-resteasy" href="resteasy.html"/>
        <link rel="prev" title="beadledom-jaxrs-genericresponse" href="jaxrs_generic_response.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Beadledom
          

          
          </a>

          
            
            
              <div class="version">
                2.7.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/introduction.html">Beadledom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/error_handling.html">Error Handling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="avro.html">Beadledom Avro</a></li>
<li class="toctree-l2"><a class="reference internal" href="bootstrap.html">Beadledom Bootstrapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="beadledom_client.html">Beadledom Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="common.html">Beadledom Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Beadledom Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">Beadledom Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="guice.html">Beadledom Guice</a></li>
<li class="toctree-l2"><a class="reference internal" href="guice_dynamic_bindings.html">Beadledom Guice Dynamic Bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="health.html">Beadledom Health</a></li>
<li class="toctree-l2"><a class="reference internal" href="jackson.html">Beadledom Jackson</a></li>
<li class="toctree-l2"><a class="reference internal" href="jaxrs.html">Beadledom JAX-RS</a></li>
<li class="toctree-l2"><a class="reference internal" href="jaxrs_generic_response.html">Beadledom JAX-RS - Generic Response</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Beadledom jOOQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download">Download</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#download-using-maven">Download using Maven</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="resteasy.html">Beadledom Resteasy</a></li>
<li class="toctree-l2"><a class="reference internal" href="resteasy_generic_response.html">Beadledom Resteasy - Generic Response</a></li>
<li class="toctree-l2"><a class="reference internal" href="stagemonitor.html">Beadledom Stagemonitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="swagger.html">Beadledom Swagger</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifecycle.html">Beadledom Lifecycle</a></li>
<li class="toctree-l2"><a class="reference internal" href="lifecycle_governator.html">Beadledom Lifecycle - Governator</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Beadledom Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/troubleshooting.html">Troubleshooting</a></li>
</ul>

            
          
  <li>
    <a href="http://cerner.github.io/beadledom/2.7.2/apidocs/index.html">Java Docs </a>
  </li>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Beadledom</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 







<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="index.html">User Manual</a> &raquo;</li>
      
    <li>beadledom-jooq</li>
    <li class="wy-breadcrumbs-aside">
      
          
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="beadledom-jooq">
<h1>beadledom-jooq<a class="headerlink" href="#beadledom-jooq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Beadledom jOOQ is a Google Guice extension for jOOQ for managing the database context and transaction lifecycle. The simplest way to use it is through the use of an annotation and Guice AOP interceptors. This provides functionality similar to <a class="reference external" href="https://github.com/google/guice/tree/master/extensions/persist">Guice Persist</a> for jOOQ instead of JPA.</p>
<p>See the <a class="reference external" href="https://www.jooq.org/learn/">jOOQ documentation</a> for details on using and configuring jOOQ.</p>
</div>
<div class="section" id="download">
<h2>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h2>
<div class="section" id="download-using-maven">
<h3>Download using Maven<a class="headerlink" href="#download-using-maven" title="Permalink to this headline">¶</a></h3>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;dependencies&gt;</span>
    ...
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.cerner.beadledom<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>beadledom-jooq<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>[Insert latest version]<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    ...
<span class="nt">&lt;/dependencies&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Install the <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/ThreadLocalJooqModule.java">ThreadLocalJooqModule</a> Guice module to enable injecting a <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/DSLContextProvider.java">DSLContextProvider</a> instance that can be used to retrieve a jOOQ <a class="reference external" href="https://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html">DSLContext</a> for making database calls. The <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/ThreadLocalJooqModule.java">ThreadLocalJooqModule</a> allows accessing a <a class="reference external" href="https://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html">DSLContext</a> that assumes database access happens within a single thread; this is the default request lifecycle for JAX-RS requests so this is a safe default. Usage across multiple threads is not supported at this time.</p>
<p>Once the Guice module is installed, any methods that will make calls to the database using the <a class="reference external" href="https://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html">DSLContext</a> must be annotated with the <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/JooqTransactional.java">JooqTransactional</a> annotation. This annotation will start a unit of work and wrap the method call in a transaction. Nested transactions can be done by nesting method calls annotated with <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/JooqTransactional.java">JooqTransactional</a>.</p>
<p>A <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html">DataSource</a> and jOOQ <a class="reference external" href="https://www.jooq.org/javadoc/latest/org/jooq/SQLDialect.html">SQLDialect</a> must be bound with Guice for the <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/ThreadLocalJooqModule.java">ThreadLocalJooqModule</a> to use.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/DSLContextProvider.java">DSLContextProvider</a> must be injected via Guice (rather than manually constructed) for the <a class="reference external" href="https://github.com/cerner/beadledom/tree/master/jooq/src/main/java/com/cerner/beadledom/jooq/JooqTransactional.java">JooqTransactional</a> annotation to work.</p>
</div>
<p>Making a database call:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreateMyModelCommand</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">DSLContextProvider</span> <span class="n">dslContextProvider</span><span class="o">;</span>

  <span class="nd">@Inject</span>
  <span class="n">CreateMyModelCommand</span><span class="o">(</span><span class="n">DSLContextProvider</span> <span class="n">dslContextProvider</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">dslContextProvider</span> <span class="o">=</span> <span class="n">dslContextProvider</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Inserts a new {@link MyModel} into the database.</span>
<span class="cm">   */</span>
  <span class="nd">@JooqTransactional</span>
  <span class="kd">public</span> <span class="n">MyModelRecord</span> <span class="nf">execute</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">dslContextProvider</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
        <span class="o">.</span><span class="na">insertInto</span><span class="o">(</span><span class="n">MY_MODEL</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">MY_MODEL</span><span class="o">.</span><span class="na">NAME</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
        <span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">MY_MODEL</span><span class="o">.</span><span class="na">DESCRIPTION</span><span class="o">,</span> <span class="n">description</span><span class="o">)</span>
        <span class="o">.</span><span class="na">returning</span><span class="o">()</span>
        <span class="o">.</span><span class="na">fetchOne</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Below is an example of configuring the required binding uses a C3P0 pooling datasource.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JooqConfigurationModule</span> <span class="kd">extends</span> <span class="n">AbstractModule</span> <span class="o">{</span>
<span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">install</span><span class="o">(</span><span class="k">new</span> <span class="n">ThreadLocalJooqModule</span><span class="o">());</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Load data source and connection pool information from configuration</span>
<span class="cm">   */</span>
  <span class="nd">@Provides</span>
  <span class="nd">@Singleton</span>
  <span class="n">DataSource</span> <span class="nf">provideDataSource</span><span class="o">(</span><span class="n">ImmutableHierarchicalConfiguration</span> <span class="n">configuration</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="n">ComboPooledDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComboPooledDataSource</span><span class="o">();</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriverClass</span><span class="o">(</span><span class="n">configuration</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;config.jooq.driver_class&quot;</span><span class="o">));</span>

      <span class="n">ImmutableHierarchicalConfiguration</span> <span class="n">connectionConfig</span> <span class="o">=</span>
          <span class="n">configuration</span><span class="o">.</span><span class="na">immutableConfigurationAt</span><span class="o">(</span><span class="s">&quot;config.jooq.connection&quot;</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setJdbcUrl</span><span class="o">(</span><span class="n">connectionConfig</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setUser</span><span class="o">(</span><span class="n">connectionConfig</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">connectionConfig</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">));</span>

      <span class="n">ImmutableHierarchicalConfiguration</span> <span class="n">c3p0Config</span> <span class="o">=</span>
          <span class="n">configuration</span><span class="o">.</span><span class="na">immutableConfigurationAt</span><span class="o">(</span><span class="s">&quot;config.jooq.c3p0&quot;</span><span class="o">);</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setMinPoolSize</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&quot;min_size&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxPoolSize</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&quot;max_size&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxStatementsPerConnection</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&quot;maxStatementsPerConnection&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setAcquireIncrement</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&quot;acquire_increment&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setTestConnectionOnCheckout</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span><span class="s">&quot;testConnectionOnCheckout&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setTestConnectionOnCheckin</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getBoolean</span><span class="o">(</span><span class="s">&quot;testConnectionOnCheckin&quot;</span><span class="o">));</span>
      <span class="n">dataSource</span><span class="o">.</span><span class="na">setMaxIdleTimeExcessConnections</span><span class="o">(</span><span class="n">c3p0Config</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="s">&quot;maxIdleTimeExcessConnections&quot;</span><span class="o">));</span>

      <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">PropertyVetoException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nd">@Provides</span>
  <span class="nd">@Singleton</span>
  <span class="n">SQLDialect</span> <span class="nf">provideSqlDialect</span><span class="o">(</span><span class="n">ImmutableHierarchicalConfiguration</span> <span class="n">configuration</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">SQLDialect</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">configuration</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;config.jooq.dialect&quot;</span><span class="o">));</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="resteasy.html" class="btn btn-neutral float-right" title="beadledom-resteasy" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="jaxrs_generic_response.html" class="btn btn-neutral" title="beadledom-jaxrs-genericresponse" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Cerner Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.7.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/github_fork.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>